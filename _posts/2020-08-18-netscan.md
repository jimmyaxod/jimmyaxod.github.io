# Netscan

Following on from yesterday, I tweaked the java portscanner, so that it's able to quickly try to connect to a large number of hosts at once, to see if any are responding.
Taking a set of hosts from the IPFS crawler, I can now periodically check on connectivity and 'health' of the network.

So, lets take the set of peers our IPFS crawler was able to connect to successfully. You should note that a peer may have more than once public address,
so some of these may point to the same peer. Especially in the case of having an ipv4 and ipv6.

|                 | Count |
| --------------- | ----- |
| Total peers     | 23193 |
| IPv6            | 10440 |
| IPv4            | 12753 |

When we attempt to connect via TCP, there's a concept of timeout... That is, how long do we wait until we give up?
Some peers respond quickly, some take a while to respond.

The maximum timeout under linux by default, is 20seconds. So trying to set our code to use a timeout longer than that will not help matters.
To change that, you can modify /proc/sys/net/ipv4/tcp_syn_retries

Here's some totals in terms of successful connections

| Timeout        | Successful | Program execution time |
| -------------- | ---------- | ---------------------- |
|          100ms |        461 |                  715ms |
|          200ms |        682 |                  915ms |
|          300ms |        856 |                  979ms |
|          400ms |       1139 |                 1044ms |
|          500ms |       1306 |                 1167ms |
|         1000ms |       1396 |                 1667ms |
|         2000ms |       2089 |                 2658ms |
|         5000ms |       2880 |                 5759ms |
|        10000ms |       3247 |                10742ms |
|        20000ms |       3705 |                20713ms |

![TCP Connect Latency](/images/tcp_connect_latency.png)
